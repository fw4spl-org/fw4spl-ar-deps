CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

PROJECT(opencvBuilder)

INCLUDE(ExternalProject)

SET(OPENCV_CMAKE_ARGS 
    -DCMAKE_PREFIX_PATH=${CMAKE_INSTALL_PREFIX}
    -DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX} 
    -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
    -DBUILD_DOCS:BOOL=OFF
    -DBUILD_TESTS:BOOL=OFF
    -DBUILD_PERF_TESTS:BOOL=OFF
    -DBUILD_SHARED_LIBS:BOOL=ON
    -DBUILD_WITH_DEBUG_INFO:BOOL=OFF
    
    -DWITH_JASPER:BOOL=OFF #jpeg2k support
    -DWITH_1394:BOOL=OFF
    -DWITH_OPENEXR:BOOL=OFF
    -DWITH_CUDA:BOOL=OFF
                       
    -DWITH_JPEG:BOOL=ON
    -DWITH_PNG:BOOL=ON
    -DWITH_QT:BOOL=OFF
    -DWITH_OPENGL:BOOL=ON
    -DWITH_TBB:BOOL=OFF
    -DWITH_TIFF:BOOL=ON
    -DWITH_ZLIB:BOOL=ON

    -DBUILD_JPEG:BOOL=OFF
    -DBUILD_PNG:BOOL=OFF
    -DBUILD_TIFF:BOOL=OFF
    -DBUILD_ZLIB:BOOL=OFF
)

IF(WIN32)
SET(OPENCV_CMAKE_ARGS ${OPENCV_CMAKE_ARGS}
    -DWITH_DSHOW:BOOL=ON
    -DWITH_MSMF:BOOL=OFF #required MSVC_2012+
    -DWITH_GSTREAMER:BOOL=OFF
    -DWITH_FFMPEG:BOOL=OFF
    )
ELSEIF(APPLE)
SET(OPENCV_CMAKE_ARGS ${OPENCV_CMAKE_ARGS}
    -DWITH_QUICKTIME:BOOL=OFF
    -DWITH_FFMPEG:BOOL=ON
    )
ELSE()
SET(OPENCV_CMAKE_ARGS ${OPENCV_CMAKE_ARGS}
    #required ffmpeg or libav development packages: libavcodec-dev, libavformat-dev, libswscale-dev
    -DWITH_FFMPEG:BOOL=ON
    -DWITH_V4L:BOOL=ON
    -DWITH_GSTREAMER:BOOL=OFF
    )
ENDIF()

GET_CACHED_URL(https://github.com/Itseez/opencv/archive/2.4.8.tar.gz CACHED_URL)

ExternalProject_Add(
    opencv
    URL ${CACHED_URL}
    DOWNLOAD_DIR ${ARCHIVE_DIR}
    DEPENDS jpeg tiff libpng zlib
    INSTALL_DIR ${CMAKE_INSTALL_PREFIX}
    CMAKE_ARGS ${OPENCV_CMAKE_ARGS}
)



